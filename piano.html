<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéπ Piano Virtual - Transforma Audio en Partitura</title>

  <!-- Estilos generales y del piano -->
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/piano.css">

  <!-- VexFlow -->
  <script src="https://unpkg.com/vexflow@4.0.1/build/cjs/vexflow.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
    }

    .page-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      color: #444;
      font-size: 1.5rem;
    }

    .piano-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .control-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: white;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
    }

    .control-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .control-btn.danger {
      background: #f44336;
    }

    .control-btn.success {
      background: #4CAF50;
    }

    .chords-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .chord-btn {
      padding: 15px 10px;
      background: #f8f9fa;
      border: 2px solid #667eea;
      border-radius: 10px;
      color: #667eea;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .chord-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-3px);
    }

    .chord-btn.active {
      background: #667eea;
      color: white;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .current-notes {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 12px;
      padding: 20px;
      color: white;
      margin: 20px 0;
    }

    .notes-display {
      font-size: 2.5rem;
      font-weight: bold;
      text-align: center;
      margin: 15px 0;
      min-height: 60px;
    }

    .notes-info {
      display: flex;
      justify-content: space-around;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .notes-list-container {
      max-height: 300px;
      overflow-y: auto;
      border: 2px solid #f0f0f0;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }

    .notes-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .note-item {
      background: white;
      padding: 10px 15px;
      border-radius: 20px;
      border: 2px solid #667eea;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .remove-note {
      background: #f44336;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .score-container {
      width: 100%;
      min-height: 400px;
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      overflow: auto;
      padding: 20px;
      margin-top: 15px;
    }

    #scoreCanvas {
      width: 100%;
      min-height: 300px;
      display: block;
    }

    .score-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .setting {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
    }

    .setting label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
    }

    @media (max-width: 768px) {
      .main-container {
        padding: 15px;
      }

      .panel {
        padding: 20px;
      }

      .notes-display {
        font-size: 2rem;
      }

      .chords-panel {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 480px) {
      .piano-controls {
        grid-template-columns: 1fr;
      }

      .chords-panel {
        grid-template-columns: repeat(2, 1fr);
      }

      .notes-display {
        font-size: 1.5rem;
      }

      .score-controls {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="page-header">
    <div style="display: flex; align-items: center; gap: 15px;">
      <a href="index.html" style="color: white; text-decoration: none; font-size: 1.3rem;">‚Üê</a>
      <h1 style="font-size: 1.4rem; display: flex; align-items: center; gap: 10px;">
        <span>üéπ</span> Piano Virtual Completo
      </h1>
    </div>
    <div style="display: flex; gap: 10px;">
      <button id="clearAll" class="control-btn danger" style="padding: 8px 15px;">
        üóëÔ∏è Limpiar Todo
      </button>
    </div>
  </header>

  <!-- Contenido Principal -->
  <main class="main-container">
    <!-- Secci√≥n 1: Piano -->
    <section class="panel">
      <h2 class="section-title">
        <span>üéπ</span> Piano Virtual (Teclado Completo)
      </h2>

      <div class="piano-container">
        <div class="piano-keys" id="pianoKeys">
          <!-- Las teclas se generan con JavaScript -->
        </div>
      </div>

      <div class="current-notes">
        <h3 style="text-align: center; margin-bottom: 10px;">Notas Actuales</h3>
        <div class="notes-display" id="currentNotesDisplay">
          --
        </div>
        <div class="notes-info">
          <div>Notas: <span id="noteCount">0</span></div>
          <div>Octava: <span id="currentOctave">4</span></div>
          <div>Acorde: <span id="currentChord">--</span></div>
        </div>
      </div>

      <div class="piano-controls">
        <button id="playSequence" class="control-btn success">
          <span>‚ñ∂Ô∏è</span> Reproducir Secuencia
        </button>
        <button id="stopPlayback" class="control-btn">
          <span>‚èπÔ∏è</span> Detener
        </button>
        <button id="exportMelody" class="control-btn">
          <span>üíæ</span> Guardar Melod√≠a
        </button>
        <button id="undoLast" class="control-btn">
          <span>‚Ü©Ô∏è</span> Deshacer √öltima
        </button>
      </div>
    </section>

    <!-- Secci√≥n 2: Acordes -->
    <section class="panel">
      <h2 class="section-title">
        <span>üé∂</span> Acordes Comunes
      </h2>
      <p style="color: #666; margin-bottom: 15px;">
        Haz clic en un acorde para tocarlo autom√°ticamente
      </p>

      <div class="chords-panel">
        <button class="chord-btn" data-chord="C" data-notes="C4,E4,G4">Do Mayor (C)</button>
        <button class="chord-btn" data-chord="G" data-notes="G4,B4,D5">Sol Mayor (G)</button>
        <button class="chord-btn" data-chord="D" data-notes="D4,F#4,A4">Re Mayor (D)</button>
        <button class="chord-btn" data-chord="A" data-notes="A4,C#5,E5">La Mayor (A)</button>
        <button class="chord-btn" data-chord="E" data-notes="E4,G#4,B4">Mi Mayor (E)</button>
        <button class="chord-btn" data-chord="F" data-notes="F4,A4,C5">Fa Mayor (F)</button>

        <button class="chord-btn" data-chord="Am" data-notes="A4,C5,E5">La Menor (Am)</button>
        <button class="chord-btn" data-chord="Em" data-notes="E4,G4,B4">Mi Menor (Em)</button>
        <button class="chord-btn" data-chord="Dm" data-notes="D4,F4,A4">Re Menor (Dm)</button>
        <button class="chord-btn" data-chord="Gm" data-notes="G4,A#4,D5">Sol Menor (Gm)</button>

        <button class="chord-btn" data-chord="C7" data-notes="C4,E4,G4,A#4">Do 7¬™ (C7)</button>
        <button class="chord-btn" data-chord="G7" data-notes="G4,B4,D5,F5">Sol 7¬™ (G7)</button>
        <button class="chord-btn" data-chord="D7" data-notes="D4,F#4,A4,C5">Re 7¬™ (D7)</button>

        <button class="chord-btn" data-chord="Csus4" data-notes="C4,F4,G4">Do Sus4 (Csus4)</button>
        <button class="chord-btn" data-chord="Gsus4" data-notes="G4,C5,D5">Sol Sus4 (Gsus4)</button>
        <button class="chord-btn" data-chord="Am7" data-notes="A4,C5,E5,G5">La m7 (Am7)</button>
      </div>

      <div style="margin-top: 20px; display: flex; gap: 10px;">
        <button id="addChordToScore" class="control-btn" style="background: #9c27b0;">
          <span>‚ûï</span> Agregar Acorde a Partitura
        </button>
        <button id="playAllChords" class="control-btn" style="background: #ff9800;">
          <span>üéµ</span> Reproducir Todos los Acordes
        </button>
      </div>
    </section>

    <!-- Secci√≥n 3: Notas y Configuraci√≥n -->
    <section class="panel">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="section-title" style="margin: 0;">
          <span>üìù</span> Notas de la Melod√≠a
        </h2>
        <div style="background: #f0f0f0; padding: 5px 15px; border-radius: 20px; font-weight: bold;">
          <span id="totalNotesCount">0</span> notas
        </div>
      </div>

      <div class="notes-list-container">
        <div class="notes-grid" id="notesList">
          <div style="text-align: center; color: #888; padding: 40px 20px; width: 100%;">
            <p style="font-size: 1.1rem; margin-bottom: 10px;">üéµ A√∫n no hay notas</p>
            <p>Toca el piano o selecciona acordes para comenzar</p>
          </div>
        </div>
      </div>

      <div class="settings-grid">
        <div class="setting">
          <label for="tempoSlider">
            üéöÔ∏è Velocidad (Tempo):
            <span id="tempoValue" style="color: #667eea; font-weight: bold;">120 BPM</span>
          </label>
          <input type="range" id="tempoSlider" min="40" max="200" value="120" style="width: 100%;">
        </div>

        <div class="setting">
          <label for="octaveSelect">üéµ Octava Principal:</label>
          <select id="octaveSelect"
                  style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
            <option value="3">Octava 3 (grave)</option>
            <option value="4" selected>Octava 4 (media)</option>
            <option value="5">Octava 5 (aguda)</option>
          </select>
        </div>

        <div class="setting">
          <label for="instrumentSelect">üéº Instrumento:</label>
          <select id="instrumentSelect"
                  style="width: 100%; padding: 10px; border-radius: 8px; border: 2px solid #ddd;">
            <option value="piano">Piano</option>
            <option value="guitar">Guitarra</option>
            <option value="strings">Cuerdas</option>
            <option value="organ">√ìrgano</option>
          </select>
        </div>

        <div class="setting">
          <label>
            <input type="checkbox" id="autoAddNotes" checked>
            Agregar notas autom√°ticamente
          </label>
          <br>
          <label style="margin-top: 10px; display: block;">
            <input type="checkbox" id="showNoteNames">
            Mostrar nombres de notas
          </label>
        </div>
      </div>
    </section>

    <!-- Secci√≥n 4: Partitura -->
    <section class="panel">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
        <h2 class="section-title" style="margin: 0;">
          <span>üìÑ</span> Partitura Generada
        </h2>
        <div class="score-controls">
          <span style="font-size: 0.9em; color: #555; margin-right: 15px; align-self: center;">
            ‚ÑπÔ∏è Doble clic en la partitura para editar
          </span>
          <button id="refreshScore" class="control-btn" style="background: #607d8b;">
            üîÑ Actualizar
          </button>
          <button id="exportPDF" class="control-btn success">
            üì• Exportar PDF
          </button>
          <button id="exportImage" class="control-btn" style="background: #2196F3;">
            üñºÔ∏è Guardar Imagen
          </button>
        </div>
      </div>

      <div class="score-container">
        <canvas id="scoreCanvas"></canvas>
      </div>

      <div style="display: flex; justify-content: space-between; margin-top: 20px; color: #666; font-size: 0.9rem; flex-wrap: wrap; gap: 15px;">
        <div><strong>Compases:</strong> <span id="measureCount">0</span></div>
        <div>
          <strong>Clave:</strong>
          <select id="clefSelect"
                  style="margin-left: 5px; padding: 5px; border-radius: 5px; border: 1px solid #ddd;">
            <option value="treble">Sol</option>
            <option value="bass">Fa</option>
            <option value="alto">Do</option>
          </select>
        </div>
        <div><strong>Tempo:</strong> <span id="scoreTempo">120</span> BPM</div>
        <div><strong>Duraci√≥n:</strong> <span id="scoreDuration">0s</span></div>
      </div>
    </section>
  </main>

  <!-- L√≥gica del piano -->
  <script type="module" src="../js/piano_m.js"></script>
</body>
</html>
